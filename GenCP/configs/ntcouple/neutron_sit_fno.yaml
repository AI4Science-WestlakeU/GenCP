# exp
exp_name: "GenCP_ntcouple_neutron_SiT_FNO"
gpu: 0
seed: 42
results_path: "./results/"

# data
dataset_name: "ntcouple"
dataset_path: "/path/to/gencp_dataset/NTcouple/"
field: "neutron"  # neutron, solid, fluid
split: "decouple_train"    # decouple_train, decouple_val, couple_train, couple_val
num_workers: 8
normalizer: "ntcouple"  # Use NTcouple fixed-bound normalizer
n_data_set: null  # null for all data, or specify number for quick experiments
length: 16  # Time steps (T dimension)

# choose
stage: "neutron"  # For ntcouple: neutron, solid, fluid
model_name: "SiT_FNO"  # CNO, SiT, FNO, SiT_FNO

use_torchcfm: True
use_diffusion: False 
use_surrogate: False

# model - SiT_FNO for NTcouple neutron field
is_resume: False
checkpoint_path: null
input_size: [64, 20]  # [H, W] spatial dimensions for neutron field
in_channels: 3  # Total input channels after concat: out_channels(1) + cond_channels(2), 5 for y1 with noise
out_channels: 1  # Target channels: neutron flux
hidden_size: 128  # Based on channel_multiplier=16 from CNO config
patch_size: [2, 1]  # Standard patch size for SiT_FNO
num_heads: 4  # Number of attention heads
depth: 4  # Number of transformer layers
modes: 4  # FNO modes for spectral operations

# training
is_use_tb: False  # Disable tensorboard (TF import issues)
x0_is_use_noise: True
use_clean_left_bc_for_solid: True  # True: 最左侧固体温度BC保持clean（不加噪）; False: 最左侧BC也参与CFM加噪
use_noise_concat: False  # True: decompose yt=[y1, E] where E=yt-y1; False: use yt directly
use_clean_cond: False
test_solid: False  # True: 温度场BC全程使用clean状态（不加噪）; False: 温度场BC也参与CFM加噪

test_interval: 1000
train_batch_size: 16  # Smaller batch size for 3D data
test_batch_size: 50

input_step: 1  # For ntcouple, we use pre-loaded conditioning
output_step: 1
stride: 1
num_delta_t: 0

# ========== 关键调整：降低初始学习率 ==========
lr: 0.0001  # 从0.0003降到0.0001
sigma: 0.0

# ========== 关键调整：正则化 ==========
dropout: 0.1  # 添加dropout防止过拟合

# iteration
train_mode: "iteration"  # epoch, iteration
total_iterations: 100000
epochs: 1000

scheduler: "cosine"
# cosine - T_max必须等于total_iterations
T_max: 100000  # 匹配total_iterations，避免学习率反弹
eta_min: 1e-7  # 最小学习率
# step - 备选方案：阶梯式下降
step_size: 10000  # 每10000步衰减
gamma: 0.8  # 每次衰减到80% (从0.5改为0.8，更平缓)

# inference
num_sampling_steps: 100

# visualize
save_figs_path: "./visualization_results"

# ntcouple specific
use_accelerator: False  # Set to True for multi-GPU training
mixed_precision: "no"  # "no", "fp16", "bf16"
gradient_accumulation_steps: 1  # 梯度累积，等效batch_size=16


